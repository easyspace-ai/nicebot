# Polymarket BTC-15分钟 Split订单策略分析

## 背景

通过split功能，可以用10美金同时获得10 share UP和10 share DOWN。在下一期还没开始时，盘口有挂单但通常不均衡（例如UP 53% DOWN 47%，或相反）。

## 策略目标

1. **获利**：利用盘口不均衡产生的价差
2. **降低风险**：通过挂单对冲，减少单边风险敞口

## 策略分析

### 策略1：套利策略（推荐）

**原理**：
- Split后，理论上UP和DOWN的价格应该都是0.50
- 如果UP价格是0.53，DOWN价格是0.47，存在套利机会
- 可以在价格高的一边卖出，在价格低的一边买入

**操作**：
1. Split获得等量UP和DOWN（例如各10 share）
2. 检查盘口价格：
   - 如果UP价格 > 0.50 + 阈值（如0.02），DOWN价格 < 0.50 - 阈值
   - 卖出部分UP（例如5 share），买入等量DOWN
   - 如果DOWN价格 > 0.50 + 阈值，UP价格 < 0.50 - 阈值
   - 卖出部分DOWN，买入等量UP
3. 保留部分仓位等待市场回归均衡

**优势**：
- 锁定价差利润
- 降低单边风险
- 如果市场回归均衡，剩余仓位可以merge回USDC

**风险**：
- 如果市场继续偏向一边，可能损失部分利润
- 需要设置合理的阈值，避免过度交易

### 策略2：做市策略

**原理**：
- Split后，在UP和DOWN两边都挂买单和卖单
- 通过买卖价差获利

**操作**：
1. Split获得等量UP和DOWN
2. 对UP和DOWN分别：
   - 在best_bid - spread挂买单
   - 在best_ask + spread挂卖单
3. 定期检查订单，如果成交则重新挂单

**优势**：
- 持续提供流动性，赚取价差
- 风险相对分散

**劣势**：
- 需要频繁调整订单
- 如果市场单边移动，可能产生较大风险敞口

### 策略3：风险对冲策略

**原理**：
- Split后，如果盘口不均衡，说明市场有偏向
- 在价格高的一边卖出部分仓位，降低风险敞口

**操作**：
1. Split获得等量UP和DOWN
2. 计算不均衡度：`imbalance = |UP_price - DOWN_price|`
3. 如果imbalance > 阈值：
   - 在价格高的一边卖出部分仓位（例如30-50%）
   - 保留价格低的一边，等待市场回归
4. 如果市场回归均衡，可以merge剩余仓位

**优势**：
- 降低单边风险
- 操作相对简单

**劣势**：
- 可能错过单边趋势的利润
- 需要合理设置卖出比例

## 推荐策略组合

**混合策略**（结合策略1和策略3）：

1. **Split阶段**：
   - 用USDC购买等量UP和DOWN

2. **价格检查**：
   - 获取UP和DOWN的best_bid和best_ask
   - 计算中间价：`mid_up = (best_bid_up + best_ask_up) / 2`
   - 计算中间价：`mid_down = (best_bid_down + best_ask_down) / 2`
   - 计算不均衡度：`imbalance = |mid_up - mid_down|`

3. **挂单决策**：
   - 如果`imbalance > 0.03`（3%价差）：
     - 如果`mid_up > mid_down`：
       - 卖出UP：在best_bid_up - 0.01挂卖单（卖出30-50%的UP仓位）
       - 买入DOWN：在best_ask_down + 0.01挂买单（买入等量DOWN）
     - 如果`mid_down > mid_up`：
       - 卖出DOWN：在best_bid_down - 0.01挂卖单（卖出30-50%的DOWN仓位）
       - 买入UP：在best_ask_up + 0.01挂买单（买入等量UP）
   
4. **风险管理**：
   - 设置最小价差阈值（如0.02），避免在价差太小时交易
   - 设置最大交易比例（如50%），保留部分仓位对冲
   - 如果市场开始（startTS），取消所有挂单，merge剩余仓位

5. **退出策略**：
   - 如果订单成交，检查是否还有不均衡
   - 如果市场开始，merge所有剩余仓位
   - 如果价差缩小到阈值以下，可以merge部分仓位

## 实现要点

1. **Split功能**：
   - 需要在CTF合约上调用split操作（merge的反向操作）
   - 或者通过CLOB同时买入等量的UP和DOWN

2. **价格监控**：
   - 定期获取订单簿（orderbook）
   - 计算best_bid和best_ask
   - 计算中间价和不均衡度

3. **订单管理**：
   - 跟踪已挂订单
   - 订单成交后更新仓位
   - 定期检查订单状态

4. **风险控制**：
   - 设置价差阈值
   - 设置交易比例限制
   - 设置时间窗口（市场开始前X分钟停止交易）

## 参数建议

- **价差阈值**：0.02-0.03（2-3%）
- **交易比例**：30-50%（保留50-70%仓位对冲）
- **挂单偏移**：0.01（在best_bid/best_ask基础上偏移）
- **最小价差**：0.01（避免在价差太小时交易）
- **停止交易时间**：市场开始前5分钟

## 预期收益

假设：
- Split 10美金，获得10 share UP + 10 share DOWN
- UP价格0.53，DOWN价格0.47（价差0.06）
- 卖出5 share UP @ 0.52，买入5 share DOWN @ 0.48
- 成本：5 * 0.48 = 2.4 USDC
- 收入：5 * 0.52 = 2.6 USDC
- **利润**：0.2 USDC（2%）
- 剩余仓位：5 share UP + 15 share DOWN（可以merge回10 USDC）

**总收益**：0.2 USDC + 可能的merge收益

## 注意事项

1. **Gas费用**：频繁交易会产生gas费用，需要确保利润 > gas费用
2. **滑点**：订单簿可能深度不够，实际成交价格可能偏离预期
3. **市场风险**：如果市场单边移动，可能产生损失
4. **流动性**：需要确保有足够的流动性来执行订单
